package auth

import (
	"xiazki/view/components"
	"xiazki/view/layout"
)

type Operation string

const (
	Login    = "login"
	Register = "register"
)

// TODO: create a struct with form values

type Data struct {
	Op     Operation
	CSRF   string
	Errors map[string]string
	Values map[string]string
}

templ Show(data Data) {
	{{
		title := map[Operation]string{Login: "Login", Register: "Register"}
		msg := map[Operation]string{Login: "Sign in to xiazki", Register: "Create your account"}
		note := map[Operation]string{Login: "Don't have an account? Register", Register: "Already have an account? Sign in"}
		href := map[Operation]string{Login: "/register", Register: "/login"}
	}}
	@layout.Base(layout.Data{Title: title[data.Op], CSRF: data.CSRF}) {
		<div class="min-h-full flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
			<div class="max-w-md w-full space-y-8">
				<div>
					<h2 class="mt-6 text-center text-3xl font-extrabold text-gray-900">
						{ msg[data.Op] }
					</h2>
				</div>
				@Form(data)
				<div class="text-center">
					<a href={ href[data.Op] } class="text-blue-600 hover:text-blue-500">
						{ note[data.Op] }
					</a>
				</div>
			</div>
		</div>
	}
}

templ Form(data Data) {
	{{
		post := map[Operation]string{Login: "/login", Register: "/register"}
		btn := map[Operation]string{Login: "Sign in", Register: "Register"}
	}}
	<form
		class="mt-8 space-y-6"
		hx-post={ post[data.Op] }
		hx-target="this"
		hx-swap="outerHTML"
		hx-headers={ "{\"X-CSRF-Token\":\"" + data.CSRF + "\"}" }
	>
		@components.Input("username", "", "Username", "text", data.Errors, data.Values["username"])
		@components.Input("password", "", "Password", "password", data.Errors, data.Values["password"])
		<div>
			<button
				type="submit"
				class="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
			>
				{ btn[data.Op] }
			</button>
		</div>
	</form>
}
